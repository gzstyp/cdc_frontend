<meta charset="utf-8"/>
<div class="row">
    <div class="col-xs-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="clearfix">
                    <table class="no-border" style="display:inline">
                        <tr>
                            <td class="hidden-480" style="padding: 0px 6px;">
                                登记日期
                            </td>
                            <td>
                                <div class="input-group">
                                    <input type="text" id="crowd_date" class="form-control search-query date-picker" placeholder="选择日期" style="width:90px;" data-date-format="yyyy-mm-dd"/>
                                </div>
                            </td>
                            <td style="padding: 0px 6px;">
                                区域位置
                            </td>
                            <td>
                                <div class="input-group">
                                    <div id="environmentSearch" style="">
                                        <select class="clsProvince" id="key_province_id" style="height:34px;cursor:pointer;margin-top:-1px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsCity','请选择省|市');"><option value=''>请选择省|市</option></select>
                                        <select class="clsCity" id="key_city_id" style="display:none;margin-top:4px;height:34px;cursor:pointer;margin-top:-4px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsCounty','请选择地州市');"><option value=''></option></select>
                                        <select class="clsCounty" id="key_county_id" style="display:none;margin-top:4px;height:34px;cursor:pointer;margin-top:-8px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsTowns','请选择区|县');"><option value=''></option></select>
                                    </div>
                                </div>
                            </td>
                            <td style="padding-left:6px;">
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" id="btnSearch">
                                            <span class="fa fa-eye bigger-110"></span>
                                            查看
                                        </button>
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="col-xs-12" style="display:flex;justify-content:center;align-items:center;padding:6px 0;border-top:1px solid #eee;border-bottom:1px solid #eee;margin-top:2px;">
                        <label style="font-size:24px;" id="labelShow">核酸日报表 (0:00-24:00)</label>
                    </div>
                    <div class="col-xs-12">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var scripts = [null,null];
    $('.page-content-area').ace_ajax('loadScripts',scripts,function(){
        $(function(){
            var urlRoute = '/reportTotal/';/*请求controller层的url*/
            var urlGetView = urlRoute + 'getView';/*查看报表*/
            var urlQueryAreaSelect = urlRoute + 'queryAreaSelect';/*获取区域数据*/
            thisPage = {
                init : function(){
                    this.addEvent();
                    winFn.initDate();
                    this.initDom();
                },
                initDom : function(){
                    thisPage.getAreaData('0','#environmentSearch','.clsProvince','选择省|市');
                },
                getAreaData : function(pid,containerDom,selectDom,labelText){
                    selectArea.getData(urlQueryAreaSelect,pid,containerDom,selectDom,labelText);
                },
                addEvent : function(){
                    this.btnEvent();
                },
                getSelectLabel : function(){
                    this.showLabel(winFn.select.getText('#key_province_id'),winFn.select.getText('#key_city_id'),winFn.select.getText('#key_county_id'),winFn.getDomValue('#crowd_date'));
                },
                btnEvent : function(){
                    $('#btnSearch').on('click',function(){
                        thisPage.viewReport();
                    });
                },
                showLabel : function(province,city,county,date){
                    var label = '';
                    if(province){
                        label += province;
                    }
                    if(city){
                        label += city;
                    }
                    if(county){
                        label += county;
                    }
                    var _date = '';
                    if(date){
                        _date += date;
                    }
                    label += '核酸日报表'+_date+' (0:00-24:00)';
                    $('#labelShow').text(label);
                },
                viewReport : function(){
                    var params = {
                        province_id : winFn.getDomValue('#key_province_id'),
                        city_id : winFn.getDomValue('#key_city_id'),
                        county_id : winFn.getDomValue('#key_county_id'),
                        crowd_date : winFn.getDomValue('#crowd_date')
                    };
                    var _this = this;
                    layerFn.queryGetHint(urlGetView,params,(data)=>{
                        _this.getSelectLabel();
                        console.log(data.data)
                    });
                },
                groupBy : function(array,f){
                    const groups = {};
                    array.forEach(function (o) {
                        const group = JSON.stringify(f(o));
                        groups[group] = groups[group] || [];
                        groups[group].push(o);
                    });
                    return Object.keys(groups).map(function (group) {
                        return groups[group];
                    });
                },
            };
            thisPage.init();
        });
    });
</script>