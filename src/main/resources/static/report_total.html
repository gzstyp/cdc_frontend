<meta charset="utf-8"/>
<div class="row">
    <div class="col-xs-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="clearfix">
                    <table class="no-border" style="display:inline">
                        <tr>
                            <td class="hidden-480" style="padding: 0px 6px;">
                                登记日期
                            </td>
                            <td>
                                <div class="input-group">
                                    <input type="text" id="crowd_date" class="form-control search-query date-picker" placeholder="选择日期" style="width:90px;" data-date-format="yyyy-mm-dd"/>
                                </div>
                            </td>
                            <td style="padding: 0px 6px;">
                                区域位置
                            </td>
                            <td>
                                <div class="input-group">
                                    <div id="environmentSearch" style="">
                                        <select class="clsProvince" id="key_province_id" style="height:34px;cursor:pointer;margin-top:-1px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsCity','请选择省|市');"><option value=''>请选择省|市</option></select>
                                        <select class="clsCity" id="key_city_id" style="display:none;margin-top:4px;height:34px;cursor:pointer;margin-top:-4px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsCounty','请选择地州市');"><option value=''></option></select>
                                        <select class="clsCounty" id="key_county_id" style="display:none;margin-top:4px;height:34px;cursor:pointer;margin-top:-8px;" onchange="thisPage.getAreaData(this.value,'#environmentSearch','.clsTowns','请选择区|县');"><option value=''></option></select>
                                    </div>
                                </div>
                            </td>
                            <td style="padding-left:6px;">
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" id="btnSearch">
                                            <span class="fa fa-eye bigger-110"></span>
                                            查看
                                        </button>
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="col-xs-12" style="display:flex;justify-content:center;align-items:center;padding:6px 0;border-top:1px solid #eee;border-bottom:1px solid #eee;margin-top:2px;">
                        <label style="font-size:22px;" id="labelShow">核酸日报表 (0:00-24:00)</label>
                    </div>
                    <div class="col-xs-12" style="">

                        <table width="100%" height="196" border="1">
                            <tr>
                                <td width="573" height="66" align="center" valign="middle">“应检尽检”人群</td>
                                <td width="582" align="center" valign="middle">“愿检尽检”人群</td>
                            </tr>
                            <tr>
                                <td><table width="576" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">社会福利养老机构工作人员</td>
                                        <td width="434"><table width="433" border="1">
                                            <tr>
                                                <td width="423">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                                <td><table width="576" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">机关事业单位人员<br /></td>
                                        <td width="434"><table width="433" border="1">
                                            <tr>
                                                <td width="423">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                            </tr>
                            <tr>
                                <td>
                                    <table width="576" border="1">
                                        <tr>
                                            <td width="126" height="101" align="center" valign="middle">机关事业单位人员</td>
                                            <td width="434"><table width="433" border="1">
                                                <tr>
                                                    <td width="423">已采样人数</td>
                                                </tr>
                                                <tr>
                                                    <td>已检测人数</td>
                                                </tr>
                                                <tr>
                                                    <td>检测阳性人数</td>
                                                </tr>
                                            </table></td>
                                        </tr>
                                    </table>    </td>
                                <td><table width="576" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">服务行业人员</td>
                                        <td width="434"><table width="433" border="1">
                                            <tr>
                                                <td width="423">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                            </tr>
                            <tr>
                                <td><table width="570" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">外省返黔师生</td>
                                        <td width="428"><table width="424" border="1">
                                            <tr>
                                                <td width="414">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                                <td><table width="576" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">企业人员</td>
                                        <td width="434"><table width="433" border="1">
                                            <tr>
                                                <td width="423">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                            </tr>
                            <tr>
                                <td><table width="570" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">新住院病人</td>
                                        <td width="428"><table width="424" border="1">
                                            <tr>
                                                <td width="414">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><table width="570" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">医疗机构工作人员</td>
                                        <td width="428"><table width="424" border="1">
                                            <tr>
                                                <td width="414">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><table width="570" border="1">
                                    <tr>
                                        <td width="126" height="101" align="center" valign="middle">发热门诊就诊患者</td>
                                        <td width="428"><table width="424" border="1">
                                            <tr>
                                                <td width="414">已采样人数</td>
                                            </tr>
                                            <tr>
                                                <td>已检测人数</td>
                                            </tr>
                                            <tr>
                                                <td>检测阳性人数</td>
                                            </tr>
                                        </table></td>
                                    </tr>
                                </table></td>
                                <td></td>
                            </tr>
                        </table>
                        
                        <!--<table width="564" height="125" border="1">
                            <tr>
                                <td height="40" colspan="2" align="center" valign="middle">“应检尽检”人群</td>
                            </tr>
                            <tr>
                                <td width="204" align="center" valign="middle">密切接触者</td>
                                <td width="344" align="left" valign="middle"><table width="348" border="1">
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                </table></td>
                            </tr>
                        </table>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var scripts = [null,null];
    $('.page-content-area').ace_ajax('loadScripts',scripts,function(){
        $(function(){
            var urlRoute = '/reportTotal/';/*请求controller层的url*/
            var urlGetView = urlRoute + 'getView';/*查看报表*/
            var urlQueryAreaSelect = urlRoute + 'queryAreaSelect';/*获取区域数据*/
            thisPage = {
                init : function(){
                    this.addEvent();
                    winFn.initDate();
                    this.initDom();
                },
                initDom : function(){
                    thisPage.getAreaData('0','#environmentSearch','.clsProvince','选择省|市');
                },
                getAreaData : function(pid,containerDom,selectDom,labelText){
                    selectArea.getData(urlQueryAreaSelect,pid,containerDom,selectDom,labelText);
                },
                addEvent : function(){
                    this.btnEvent();
                },
                getSelectLabel : function(){
                    this.showLabel(winFn.select.getText('#key_province_id'),winFn.select.getText('#key_city_id'),winFn.select.getText('#key_county_id'),winFn.getDomValue('#crowd_date'));
                },
                btnEvent : function(){
                    $('#btnSearch').on('click',function(){
                        thisPage.viewReport();
                    });
                },
                showLabel : function(province,city,county,date){
                    var label = '';
                    if(province){
                        label += province;
                    }
                    if(city){
                        label += city;
                    }
                    if(county){
                        label += county;
                    }
                    var _date = '';
                    if(date){
                        _date += date;
                    }
                    label += '核酸日报表'+_date+' (0:00-24:00)';
                    $('#labelShow').text(label);
                },
                viewReport : function(){
                    var params = {
                        province_id : winFn.getDomValue('#key_province_id'),
                        city_id : winFn.getDomValue('#key_city_id'),
                        county_id : winFn.getDomValue('#key_county_id'),
                        crowd_date : winFn.getDomValue('#crowd_date')
                    };
                    var _this = this;
                    layerFn.queryGetHint(urlGetView,params,(data)=>{
                        _this.getSelectLabel();
                        _this.renderTable(data.data);
                    });
                },
                renderTable : function(data){
                    var _col = [];
                    var columns = [];
                    for(var i=0;i < data.length;i++){
                        var obj = data[i];
                        for(var key in obj){
                            if(key == 'crowdName'){
                               var _val = obj[key];
                               if(_col.indexOf(_val) === -1){
                                   _col.push(_val);
                                   var as = {};
                                   as[key]=_val;
                                   columns.push(as);
                               }
                            }
                        }
                    }
                    console.log(_col);
                    console.log(columns);
                    console.log(columns.length);

                    var containerTabel = 'containerTabel';
                    var html = '';

                    var tr = '<tr>';
                    var _tr = '</tr>';

                    html += tr;
                    for(var item in columns){
                        console.log(columns[item].crowdName);
                        html += '<td align="center" valign="middle">'+columns[item].crowdName+'</td>';
                    }
                    html += _tr;
                    /*-------------------------*/
                    html += tr;



                    for(var item in columns){
                        for(var x=0;x < data.length;x++){
                            var obj = data[x];
                            for(var key in obj){
                                if(key == 'crowdType'){
                                    html += '<td>';
                                        html += '<table>';
                                            html += '<tr>';
                                            html += '<td align="center" valign="middle">'+obj[key]+'</td>';
                                                html += '<td>';
                                                    html += '<table>';
                                                    html += '<tr>';
                                                    html += '<td>已采样人数</td>';
                                                    html += '</tr>';
                                                    html += '<tr>';
                                                    html += '<td>已检测人数</td>';
                                                    html += '</tr>';
                                                    html += '<tr>';
                                                    html += '<td>检测阳性人数</td>';
                                                    html += '</tr>';
                                                    html += '</table>';
                                                html += '</td>';
                                        html += '</tr>';
                                        html += '</table>';
                                    html += '</td>';
                                }
                            }


                            /*html += '<td>';
                                html += '<table>';
                                    html += '<tr>';
                                        html += '<td align="center" valign="middle">密切接触者</td>';
                                        html += '<td>';
                                            html += '<table>';
                                            html += '<tr>';
                                            html += '<td>已采样人数</td>';
                                            html += '</tr>';
                                            html += '<tr>';
                                            html += '<td>已检测人数</td>';
                                            html += '</tr>';
                                            html += '<tr>';
                                            html += '<td>检测阳性人数</td>';
                                            html += '</tr>';
                                            html += '</table>';
                                        html += '</td>';
                                    html += '</tr>';
                                html += '</table>';
                            html += '</td>';*/
                        }
                    }

                    /*for(var item in columns){
                        html += '<td>';
                            html += '<table>';
                                html += '<tr>';
                                    html += '<td align="center" valign="middle">密切接触者</td>';
                                    html += '<td>';
                                        html += '<table>';
                                        html += '<tr>';
                                        html += '<td>已采样人数</td>';
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>已检测人数</td>';
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>检测阳性人数</td>';
                                        html += '</tr>';
                                        html += '</table>';
                                    html += '</td>';
                                html += '</tr>';
                            html += '</table>';
                        html += '</td>';
                    }*/
                    html += _tr;
                    $('#' + containerTabel).html(html);
                },
                dd : function(arr){
                    var map = new Map();
                    var array = new Array(); // 数组用于返回结果
                    for (var i = 0; i < arr.length; i++) {
                        if(map .has(arr[i])){ // 如果有该key值
                            map .set(arr[i],true);
                        } else {
                            map .set(arr[i],false); // 如果没有该key值
                            array .push(arr[i]);
                        }
                    }
                    return array;
                }
            };
            thisPage.init();
        });
    });
</script>