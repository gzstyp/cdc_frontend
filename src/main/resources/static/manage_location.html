<meta charset="utf-8"/>
<div class="row">
    <div class="col-xs-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="clearfix">
                    <table class="no-border" style="display:inline">
                        <tr permission='manageLocation_btn_listData' style="display:none">
                            <td style="padding: 0px 6px;">
                                场所首写字母
                            </td>
                            <td>
                                <div class="input-group">
                                    <input type="text" id="key_site_letter" class="form-control search-query" placeholder="经营场所首字母" style="width:120px"/>
                                </div>
                            </td>
                            <td style="padding: 0px 6px;">
                                场所名称
                            </td>
                            <td>
                                <div class="input-group">
                                    <input type="text" id="key_site_name" class="form-control search-query" placeholder="经营场所名称" style="width:120px"/>
                                </div>
                            </td>
                            <td style="padding: 0px 6px;" class="areaSelectText">
                                区域位置
                            </td>
                            <td class="areaSelectText">
                                <div class="input-group">
                                    <div id="manageSearch"></div>
                                </div>
                            </td>
                            <td class="hidden-480" style="padding: 0px 6px;">
                                联系人
                            </td>
                            <td>
                                <div class="input-group">
                                    <input type="text" id="key_linkman" class="form-control search-query hidden-480" placeholder="场所联系人" style="width:80px"/>
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" id="btnSearch" permission='manageLocation_btn_listData' style="display:none">
                                            <span class="ace-icon fa fa-search bigger-110"></span>
                                            搜索
                                        </button>
                                    </span>
                                </div>
                            </td>
                            <td>
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" id="btnAdd" permission='manageLocation_btn_add' style="display:none">
                                            <span class="ace-icon glyphicon glyphicon-plus bigger-110"></span>
                                            添加
                                        </button>
                                    </span>
                                </div>
                            </td>
                            <td>
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" id="btnDel" permission='manageLocation_btn_delByKeys' style="display:none">
                                            <span class="fa fa-trash red2 bigger-110"></span>
                                            删除
                                        </button>
                                    </span>
                                </div>
                            </td>
                            <td>
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-inverse btn-white" title="导入Excel数据" id="btnImport" permission='manageLocation_btn_import' style="display:none">
                                            <span class="fa fa-download"></span>
                                            导入
                                        </button>
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="hidden-480 pull-right tableTools-container" permission='manageLocation_btn_listData' style="display:none"></div>
                </div>
                <table id="tableListManageLocation" class="table table-striped table-bordered table-hover"></table>
            </div>
        </div>
    </div>
</div>
<div id="div_bs_manage_edit" style="display:none;padding-top:20px">
    <form class="form-horizontal" id="form_bs_manage_edit" role="form">
        <label class="col-sm-3 control-label no-padding-right" for="site_name"><div class="hr-4"></div>经营场所名称</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <input type="text" id="site_name" placeholder="经营场所名称" class="form-control"/>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="site_type"><div class="hr-4"></div>经营场所类型</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <div class="input-group">
                <span class="input-group-btn">
                    <button data-toggle="dropdown" class="btn btn-primary btn-white dropdown-toggle col-sm-12" style="margin-left:0.01em">
                        <span id="dropdownLabelsite_type">选择场所类型</span>
                        <i class="ace-icon fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu col-sm-12" style="margin-left:-1px;width:400px;min-width:400px;max-width:400px" id="dropdownOptionssite_type"></ul><!--注意宽度,含有富文本编辑器宽度是448px-->
                    <input id="site_type" type="hidden"/>
                </span>
            </div>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="linkman"><div class="hr-4"></div>联系人</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <input type="text" id="linkman" placeholder="联系人" class="form-control"/>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="mobile"><div class="hr-4"></div>联系电话</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <input type="text" id="mobile" placeholder="联系电话" class="form-control"/>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="address"><div class="hr-4"></div>区域位置</label>
        <div class="col-sm-7" title="编辑|修改时不选择则保持原数据原区域">
            <div class="hr-4"></div>
            <div id="manageLocation">
                <select class="col-sm-12 clsProvince" id="userProvinceId" style="cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#manageLocation','.clsCity','请选择市|区');"><option value=''></option></select>
                <select class="col-sm-12 clsCity" id="userCityId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#manageLocation','.clsCounty','请选择区|县');"><option value=''></option></select>
                <select class="col-sm-12 clsCounty" id="userCountyId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#manageLocation','.clsTowns','请选择乡|镇|社区');"><option value=''></option></select>
                <!--<select class="col-sm-12 clsTowns" id="userTownsId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#manageLocation','.clsVallage','请选择村|居委会');"><option value=''></option></select>
                <select class="col-sm-12 clsVallage" id="userVallageId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#manageLocation','.clsXxx','请选择区域');"><option value=''></option></select>-->
            </div>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="address"><div class="hr-4"></div>场所地址</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <input type="text" id="address" placeholder="场所地址" class="form-control"/>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="freeze"><div class="hr-4"></div>是否有冷冻冷藏产品</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <div class="input-group">
                <span class="input-group-btn">
                    <button data-toggle="dropdown" class="btn btn-primary btn-white dropdown-toggle col-sm-12" style="margin-left:0.01em">
                        <span id="dropdownLabelfreeze">选择选项</span><!--注意显示文字-->
                        <i class="ace-icon fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu col-sm-12" style="margin-left:-1px;width:400px;min-width:400px;max-width:400px">
                        <li>
                            <a id="freeze_" href="javascript:winFn.dropdown('#freeze','','#dropdownLabelfreeze','选择选项');">选择选项</a>
                        </li>
                        <li>
                            <a id="freeze1" href="javascript:winFn.dropdown('#freeze',1,'#dropdownLabelfreeze','是');">是</a>
                        </li>
                        <li>
                            <a id="freeze0" href="javascript:winFn.dropdown('#freeze',0,'#dropdownLabelfreeze','否');">否</a>
                        </li>
                    </ul>
                    <input id="freeze" type="hidden"/>
                </span>
            </div>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="entrance"><div class="hr-4"></div>是否含有冷冻进口产品</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <div class="input-group">
                <span class="input-group-btn">
                    <button data-toggle="dropdown" class="btn btn-primary btn-white dropdown-toggle col-sm-12" style="margin-left:0.01em">
                        <span id="dropdownLabelentrance">选择选项</span><!--注意显示文字-->
                        <i class="ace-icon fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu col-sm-12" style="margin-left:-1px;width:400px;min-width:400px;max-width:400px;"><!--注意宽度-->
                        <li>
                            <a id="entrance_" href="javascript:winFn.dropdown('#entrance','','#dropdownLabelentrance','选择选项');">选择选项</a>
                        </li>
                        <li>
                            <a id="entrance0" href="javascript:winFn.dropdown('#entrance',0,'#dropdownLabelentrance','否');">否</a>
                        </li>
                        <li>
                            <a id="entrance1" href="javascript:winFn.dropdown('#entrance',1,'#dropdownLabelentrance','是');">是</a>
                        </li>
                    </ul>
                    <input id="entrance" type="hidden"/>
                </span>
            </div>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="risk"><div class="hr-4"></div>是否有高中风险地区产品</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <div class="input-group">
                <span class="input-group-btn">
                    <button data-toggle="dropdown" class="btn btn-primary btn-white dropdown-toggle col-sm-12" style="margin-left:0.01em">
                        <span id="dropdownLabelrisk">选择选项</span><!--注意显示文字-->
                        <i class="ace-icon fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu col-sm-12" style="margin-left:-1px;width:390px;min-width:390px;max-width:390px;"><!--注意宽度-->
                        <li>
                            <a id="risk_" href="javascript:winFn.dropdown('#risk','','#dropdownLabelrisk','选择选项');">选择选项</a>
                        </li>
                        <li>
                            <a id="risk1" href="javascript:winFn.dropdown('#risk',1,'#dropdownLabelrisk','是');">是</a>
                        </li>
                        <li>
                            <a id="risk0" href="javascript:winFn.dropdown('#risk',0,'#dropdownLabelrisk','否');">否</a>
                        </li>
                    </ul>
                    <input id="risk" type="hidden">
                </span>
            </div>
        </div>
        <label class="col-sm-3 control-label no-padding-right" for="remark"><div class="hr-4"></div>备注</label>
        <div class="col-sm-7">
            <div class="hr-4"></div>
            <textarea type="text" rows="2" id="remark" placeholder="备注" class="form-control"></textarea>
        </div>
    </form>
</div>
<div id="divKeyColumns" style="display:none;padding:1px 0px;"></div>
<input type="hidden" id="bs_manage_edit_keyId"/>
<div id="div_manage_import" style="display:none;padding-top:10px">
    <form class="form-horizontal" id="form_manage_import" role="form">
        <label class="col-sm-2 control-label no-padding-right"><div class="hr-2"></div>导入区域</label>
        <div class="col-sm-10" title="请选择经营场所区域">
            <div class="hr-4"></div>
            <div id="div_area_import">
                <select class="col-sm-12 clsProvince" id="excelImportProvinceId" style="cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#div_area_import','.clsCity','请选择市|区');"><option value=''></option></select>
                <select class="col-sm-12 clsCity" id="excelImportCityId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#div_area_import','.clsCounty','请选择区|县');"><option value=''></option></select>
                <select class="col-sm-12 clsCounty" id="excelImportCountyId" style="display:none;margin-top:4px;cursor:pointer;" onchange="thisPage.getAreaData(this.value,'#div_area_import','.clsTowns','请选择乡|镇|社区');"><option value=''></option></select>
            </div>
        </div>
        <div class="col-sm-12" id="div_manage_file_import">
            <div class="hr-4"></div>
            <input type="file" id="file_manage_import" class="form-control"/>
        </div>
    </form>
</div>
<div style="display:none;">
    <input type="hidden" id="manageLocation_btn_listData"/>
    <input type="hidden" id="manageLocation_btn_add"/>
    <input type="hidden" id="manageLocation_btn_delByKeys"/>
    <input type="hidden" id="manageLocation_btn_import"/>
    <input type="hidden" id="manageLocation_row_edit"/>
    <input type="hidden" id="manageLocation_row_queryById"/>
    <input type="hidden" id="manageLocation_row_delById"/>
    <input type="hidden" id="manageLocation_btn_getManagerLocation"/>
</div>
<script type="text/javascript">
    var scripts = [null,null];
    $('.page-content-area').ace_ajax('loadScripts',scripts,function(){
        var tableDom = '#tableListManageLocation';
        var inputEditKeyId = '#bs_manage_edit_keyId';
        $(function(){
            var urlRoute = '/manageLocation/';/*请求controller层的url*/
            var getList = urlRoute + 'listData';/*获取数据列表,此处不需要添加的,已在请求的url添加了前缀*/
            var urlAdd = urlRoute + 'add';/*添加*/
            var urlEdit = urlRoute + 'edit';/*编辑*/
            var urlQueryById = urlRoute + 'queryById';/*根据id查询对应的数据*/
            var urlGetManagerLocation = urlRoute + 'getManagerLocation';/*获取经营场所*/
            var urlDelById = urlRoute + 'delById';/*根据id删除对应的数据*/
            var urlDelByKeys = urlRoute + 'delByKeys';/*批量删除*/
            var urlImportExcel = urlRoute + 'importExcel';/*导入Excel*/
            var urlQueryAreaSelect = urlRoute + 'queryAreaSelect';/*获取区域数据*/
            var thisTable = pageDataTable.initDataTable({
                tableDom : tableDom,
                sAjaxSource: getList,
                fnServerParams : function(params){
                    var areaKid = sessionStorage.getItem("areaKid");
                    var areaLevel = sessionStorage.getItem("areaLevel");
                    if(areaKid != null && areaKid != undefined){
                        params.push({"name":"areaKid","value":areaKid},{"name":"areaLevel","value":areaLevel});
                    }
                    params.push({"name":"site_letter","value":$("#key_site_letter").val()},{"name":"site_name","value":$("#key_site_name").val()},{"name":"linkman","value":$("#key_linkman").val()},{"name":"province_id","value":$("#manageSearch .clsProvince").val()},{"name":"city_id","value":$("#manageSearch .clsCity").val()},{"name":"county_id","value":$("#manageSearch .clsCounty").val()});
                },
                aoColumns : [
                    {
                        bSortable: false,
                        mData : "kid",
                        sWidth : "38px",
                        sClass : "center",
                        sTitle : '<label title="全选|不选"><input type="checkbox" class="ace" /><span class="lbl"></span></label>'
                    },
                    {
                        mData : "city",
                        sTitle : "市|区级"
                    },
                    {
                        mData : "county",
                        sTitle : "区|县级"
                    },
                    {
                        mData : "site_type_label",
                        sTitle : "场所类型"
                    },
                    {
                        mData : "site_name",
                        sTitle : "名称"
                    },
                    {
                        mData : "linkman",
                        sTitle : "联系人"
                    },
                    {
                        mData : "mobile",
                        sTitle : "联系人手机号"
                    },
                    {
                        mData : "address",
                        sTitle : "地址"
                    },
                    {
                        mData : "freeze",
                        sTitle : "是否有冷冻冷藏产品",
                        render : function(value,type,row,meta){
                            if(value == '0'){
                                return '否';
                            }else if(value == '1'){
                                return '是';
                            }else{
                                return "";
                            }
                        }
                    },
                    {
                        mData : "entrance",
                        sTitle : "是否含冷冻进口产品",
                        render : function(value,type,row,meta){
                            if(value == '0'){
                                return '否';
                            }else if(value == '1'){
                                return '是';
                            }else{
                                return "";
                            }
                        }
                    },
                    {
                        mData : "risk",
                        sTitle : "是否含有高中风险地区产品",
                        render : function(value,type,row,meta){
                            if(value == 0){
                                return '否';
                            }else if(value == 1){
                                return '是';
                            }else{
                                return "";
                            }
                        },
                        sWidth : "12%"
                    },
                    /*{
                        mData : "user_name",
                        sTitle : "登记人"
                    },
                    {
                        mData : "remark",
                        sTitle : "备注",
                        sWidth : "12%"
                    },*/
                    {
                        mData : "_kid_",
                        sTitle : "<label style='color:#000;margin-left:6px;' title='单行操作'>操作选项</label>",
                        bSortable : false,
                        sWidth : "6%"
                    }
                ],
                columnDefs : [
                    {
                        targets : 0,//指定的列
                        render : function(value,type,row,meta){//第1个参数可能会没有值!!!,当key不存在时就没有值
                            return '<label title="选择|取消"><input type="checkbox" name="kid" value="'+value+'" style="cursor:pointer;text-decoration:none;outline:none;"/><span class="lbl"></span></label>';
                        }
                    },
                    {
                        targets : -1,
                        render : function(value,type,row,meta){
                            var html = "<a href='javascript:thisPage.rowEdit("+meta.row+");' style='outline:none;text-decoration: none;color:#3b8cff;margin-left:6px;display:none' permission='manageLocation_row_edit'>编辑</a>"+
                                "<a class='hidden-xs' href='javascript:thisPage.rowDel("+meta.row+");' style='outline:none;text-decoration: none;color:#f00;margin-left:6px;display:none' permission='manageLocation_row_delById'>删除</a>";
                            return html;
                        }
                    },
                    {
                        targets: [1,2,3,4,5,6,7,8,9,10],
                        render: function (value,type,row,meta){
                            return pageDataTable.formatColumn(value);
                        }
                    },
                    {
                        "visible":true,//列的隐藏显示
                        "targets": [5,7,9,10]
                    }
                ]
            });
            pageDataTable.buttons(thisTable);
            pageDataTable.action(thisTable);
            pageDataTable.select(thisTable,tableDom);
            pageDataTable.tooltip();
            var thisJquery = $(tableDom).dataTable();
            thisPage = {
                init : function(){
                    this.addEvent();
                    this.initDom();
                },
                initDom : function(){
                    userArea.renderUserArea(urlQueryAreaSelect,'#manageSearch');
                    layerFn.ajaxGet(urlGetManagerLocation,{},function(data){
                        if(data.code === AppKey.code.code200){
                            winFn.initDropdown(data.data,'#dropdownOptionssite_type','#site_type','#dropdownLabelsite_type','选择场所类型');
                        }
                    });
                    winFn.initFileShoose('#file_manage_import',['xls','xlsx']);
                },
                addEvent : function(){
                    this.btnEvent();
                },
                getAreaData : function(pid,containerDom,selectDom,labelText){
                    selectArea.getData(urlQueryAreaSelect,pid,containerDom,selectDom,labelText);
                },
                btnEvent : function(){
                    $(tableDom +' tbody').on('dblclick','tr',function(){
                        if(verifyFn.inputRequired('#manageLocation_row_edit')){
                            return;
                        }
                        thisPage.trDblclick(thisTable.row(this).data());
                    });
                    $('#btnAdd').on('click',function(){
                        thisPage.edit();
                    });
                    //搜索按钮
                    $('#btnSearch').on('click',function(){
                        thisPage.search();
                    });
                    //按钮组-自定义显示列
                    $('#iconColumn').parent().parent().on('click',function(){
                        pageDataTable.columnCustom(thisTable,tableDom,'#divKeyColumns');
                    });
                    //按钮组-搜索
                    $('#iconRefresh').parent().parent().on('click',function(){
                        thisPage.search();
                    });
                    $('#btnDel').on('click',function(){
                        thisPage.delKeys();
                    });
                    //导入
                    $('#btnImport').on('click',function(){
                        if(verifyFn.inputRequired('#manageLocation_btn_import')){
                            layerFn.alert('没有导入操作权限',AppKey.code.code199);
                            return;
                        }
                        thisPage.exportImport();
                    });
                },
                /*批量删除*/
                delKeys : function(){
                    var kids = '';
                    var index = 0;
                    $(tableDom + ' tbody input:checked').each(function(){
                        index ++;
                        var value = this.value;
                        if(value != null && value != ''){
                            if(kids.length > 0)
                                kids += ",";
                            kids += value;
                        }
                    });
                    if(kids == ''){
                        layerFn.alert('请选择要删除的数据!',AppKey.code.code199);
                        return;
                    }
                    if(verifyFn.inputRequired('#manageLocation_btn_delByKeys')){
                        layerFn.alert('没有删除操作权限',AppKey.code.code199);
                        return;
                    }
                    layerFn.confirm('将要准备删除['+index+']数据且是无法恢复,确定要继续吗?',function(){
                        layerFn.delBatchHint(urlDelByKeys,kids,function(data){
                            thisPage.complete(data,null,true);
                        });
                    });
                },
                trDblclick : function(data){
                    thisPage.edit(data.kid);
                },
                exportImport : function(){
                    winFn.removeInputFile('#div_manage_file_import');
                    layerFn.addOrEdit('区域的经营场所数据导入','#div_manage_import',['400px','250px'],(index,layero)=>{
                        if(verifyFn.inputRequired('#excelImportProvinceId')){
                            layerFn.alert('请选择区域省|市',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#excelImportCityId')){
                            layerFn.alert('请选择区域市|区',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#excelImportCountyId')){
                            layerFn.alert('请选择区域区|县',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#file_manage_import')){
                            layerFn.alert('请选择Excel文件',AppKey.code.code199);
                            return;
                        }
                        var params = {
                            excel : winFn.getDomValue('#file_manage_import'),
                            province_id : winFn.getDomValue('#excelImportProvinceId'),
                            city_id : winFn.getDomValue('#excelImportCityId'),
                            county_id : winFn.getDomValue('#excelImportCountyId')
                        };
                        var formData = new FormData();
                        for(var key in params){
                            formData.append(key,params[key]);
                        }
                        formData.append("file_excel",document.getElementById("file_manage_import").files[0]);//获取上传文件
                        layerFn.formSubmit(urlImportExcel,formData,function(data){
                            thisPage.complete(data,index,true);
                        });
                    });
                    thisPage.getAreaData('0','#div_area_import','.clsProvince','选择省|市');
                },
                search : function(){
                    if(verifyFn.inputRequired('#manageLocation_btn_listData')){
                        layerFn.alert('没有操作权限',AppKey.code.code199);
                        return;
                    }
                    $(tableDom + ' input[type=checkbox]').prop('checked',false);
                    thisTable.draw();
                },
                resetForm : function(){
                    winFn.clearFormData('#form_bs_manage_edit');
                },
                edit : function(kid){
                    var title = '添加';
                    if(kid != '' && kid != undefined){
                        if(verifyFn.inputRequired('#manageLocation_row_queryById')){
                            layerFn.alert('没有操作权限',AppKey.code.code199);
                            return;
                        }
                        title = '编辑';
                        winFn.setDomValue(inputEditKeyId,kid);
                        layerFn.queryByIdHint(urlQueryById,kid,function(data){
                            thisPage.openDialog(title,kid,data);
                        });
                    }else{
                        winFn.setDomValue(inputEditKeyId,'');
                        thisPage.openDialog(title);
                    }
                },
                openDialog : function(title,kid,map){
                    layerFn.addOrEdit(title,'#div_bs_manage_edit',['700px','550px'],function(index,layero){
                        var editKey = winFn.getDomValue(inputEditKeyId);
                        if(verifyFn.inputRequired('#site_name')){
                            layerFn.alert('经营场所名称不能为空',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#site_type')){
                            layerFn.alert('请选择场所类型',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#linkman')){
                            layerFn.alert('联系人不能为空',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#mobile')){
                            layerFn.alert('联系电话不能为空',AppKey.code.code199);
                            return;
                        }
                        if(editKey == null){
                            if(verifyFn.inputRequired('#userProvinceId')){
                                layerFn.alert('请选择区域省|市',AppKey.code.code199);
                                return;
                            }
                            if(verifyFn.inputRequired('#userCityId')){
                                layerFn.alert('请选择区域市|区',AppKey.code.code199);
                                return;
                            }
                            if(verifyFn.inputRequired('#userCountyId')){
                                layerFn.alert('请选择区域区|县',AppKey.code.code199);
                                return;
                            }
                        }
                        if(verifyFn.inputRequired('#address')){
                            layerFn.alert('场所地址不能为空',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#freeze')){
                            layerFn.alert('请选择是否有冷冻冷藏产品',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#entrance')){
                            layerFn.alert('请选择是否含有冷冻进口产品',AppKey.code.code199);
                            return;
                        }
                        if(verifyFn.inputRequired('#risk')){
                            layerFn.alert('请选择是否含有高中风险地区产品',AppKey.code.code199);
                            return;
                        }
                        var province_id = winFn.getDomValue('#userProvinceId');//省
                        var city_id = winFn.getDomValue('#userCityId');//市
                        var county_id = winFn.getDomValue('#userCountyId');//县
                        var towns_id = winFn.getDomValue('#userTownsId');//区
                        var vallage_id = winFn.getDomValue('#userVallageId');//村
                        var params = {
                            site_name : winFn.getDomValue('#site_name'),
                            site_letter : winFn.getDomValue('#site_letter'),
                            site_type : winFn.getDomValue('#site_type'),
                            linkman : winFn.getDomValue('#linkman'),
                            mobile : winFn.getDomValue('#mobile'),
                            province_id : province_id,
                            city_id : city_id,
                            county_id : county_id,
                            towns_id : towns_id,
                            vallage_id : vallage_id,
                            address : winFn.getDomValue('#address'),
                            freeze : winFn.getDomValue('#freeze'),
                            entrance : winFn.getDomValue('#entrance'),
                            risk : winFn.getDomValue('#risk'),
                            remark : winFn.getDomValue('#remark'),
                            kid : editKey
                        };
                        var url = urlAdd;
                        if (kid != null && kid != ''){
                            url = urlEdit;
                            if(verifyFn.inputRequired('#manageLocation_row_edit')){
                                layerFn.alert('没有编辑操作权限',AppKey.code.code199);
                                return;
                            }
                        }else{
                            if(verifyFn.inputRequired('#manageLocation_btn_add')){
                                layerFn.alert('没有添加操作权限',AppKey.code.code199);
                                return;
                            }
                        }
                        layerFn.submit(url,params,function(data){
                            thisPage.complete(data,index,true);
                        });
                    });
                    thisPage.resetForm();//清空
                    if(map != null){
                        $.each(map.data,function(k,v){
                            try{
                                $('#'+k).val(v);
                                if(k == 'freeze'){
                                    winFn.editDropdown('#dropdownLabelfreeze','freeze'+v);
                                }
                                if(k == 'entrance'){
                                    winFn.editDropdown('#dropdownLabelentrance','entrance'+v);
                                }
                                if(k == 'risk'){
                                    winFn.editDropdown('#dropdownLabelrisk','risk'+v);
                                }
                                if(k == 'site_type'){
                                    winFn.editDropdown('#dropdownLabelsite_type',v);
                                }
                            }catch(e){}
                        });
                    }else{
						winFn.addDropdown('#dropdownLabelfreeze','选择选项');
						winFn.addDropdown('#dropdownLabelentrance','选择选项');
						winFn.addDropdown('#dropdownLabelrisk','选择选项');
                        winFn.addDropdown('#dropdownLabelsite_type','选择场所类型');
				    }
                    thisPage.getAreaData('0','#manageLocation','.clsProvince','选择省|市');
                },
                rowEdit : function(index){
                    var row = thisJquery.fnGetData(index);
                    thisPage.edit(row.kid);
                },
                rowDel : function(index){
                    var row = thisJquery.fnGetData(index);
                    if(verifyFn.inputRequired('#manageLocation_row_delById')){
                        layerFn.alert('没有删除操作权限',AppKey.code.code199);
                        return;
                    }
                    layerFn.confirm('删除后无法恢复,确定要删除吗?',function(){
                        layerFn.delByIdHint(urlDelById,row.kid,function(data){
                            thisPage.complete(data,null,true);
                        });
                    });
                },
                complete : function(data,index,search){
                    try{
                        if(index){
                            layerFn.closeIndex(index);
                        }
                        if(search){
                            thisPage.search();
                        }
                        if(data){
                            layerFn.handleResult(data.msg,data.code);
                        }
                    }catch(e){}
                }
            };
            thisPage.init();
        });
    });
</script>